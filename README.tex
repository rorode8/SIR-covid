% This LaTeX was auto-generated from MATLAB code.
% To make changes, update the MATLAB code and export to LaTeX again.

\documentclass{article}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{graphicx}
\usepackage{color}
\usepackage{hyperref}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{epstopdf}
\usepackage[table]{xcolor}
\usepackage{matlab}

\sloppy
\epstopdfsetup{outdir=./}
\graphicspath{ {./README_images/} }

\matlabhastoc

\begin{document}

\label{T_E81BD9AA}
\matlabtitle{Curvas de comportamiento de COVID 19}

\begin{par}
\begin{flushleft}
\href{https://github.com/rorode8/SIR-covid}{\underline{repositorio de github}}
\end{flushleft}
\end{par}

\begin{par}
\begin{flushleft}
El comportamiento de epidemias puede ser simulado con modelos matemáticos o modelos estadísticos. En este estudio nos concentraremos en los modelos matemáticos. Específicamente usaremos un modelo \textbf{compartimental}. Los modelos de este tipo simplifican el problema al dividir la población total en compartimentos, asumiendo que cada individuo en un mismo compartimento tiene las mismas características.
\end{flushleft}
\end{par}

\matlabtableofcontents{Tabla de contenidos}

\vspace{1em}
\label{H_89D14292}
\matlabheading{Identificación del Problema}

\label{H_94A2E453}
\matlabheadingtwo{Objetivo}

\begin{par}
\begin{flushleft}
Desarrollar diferentes modelos matemáticos por medio de ODEs que nos permitan entender distintos aspectos de la pandemia, tales como medir la velocidad de propagación de los contagios, establecer el rol de algunos mecanismos en el proceso de propagación, evaluar medidas de mitigación y contención, hacer estimaciones de la capacidad hospitalaria, etc.
\end{flushleft}
\end{par}

\label{H_ACEE4DF2}
\matlabheadingtwo{Requisitos}

\begin{par}
\begin{flushleft}
Para simular el comportamiento de la epidemia usaremos el modelo \textbf{SIR }(\textbf{S}usceptible \textbf{I}nfectious \textbf{R}emoved)[1]. El modelo consiste de al menos tres compartimientos.
\end{flushleft}
\end{par}

\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item{\begin{flushleft} \textbf{S}: Personas susceptibles. Estos se pueden pasar al grupo de \textbf{I}nfectados al tener contacto con uno de ellos. \end{flushleft}}
   \item{\begin{flushleft} \textbf{I}: Personas infectadas. Aquellos que son portadores de la enfermedad. \end{flushleft}}
   \item{\begin{flushleft} \textbf{R}: Personas con inmunidad o que murieron. Este grupo puede ser interpretado de varias formas, pero son aquellas que fueron infectadas y ya no pertenecen a ese grupo. \end{flushleft}}
\end{itemize}

\begin{par}
\begin{flushleft}
Cabe mencionar que este modelo, a pesar de ser muy usado en epidemiología, es muy básico porque no considera nacimientos o muertes en el análisis, tampoco la edad de las personas o la situación o estructura social en la que se encuentran. 
\end{flushleft}
\end{par}

\begin{par}
\begin{flushleft}
Al final compararemos nuestras gráficas de variables continuas contra las variables discretas y veremos qué similitudes y diferencias se crean entre la realidad y este modelo matemático simple.
\end{flushleft}
\end{par}

\begin{par}
\begin{flushleft}
Para considerarse exitoso el modelo deberá asimilar los datos reales en al menos un escenario con datos previos contra los que se le compare.
\end{flushleft}
\end{par}

\label{H_669754B6}
\matlabheading{\textbf{Modelo Matemático}}


\vspace{1em}
\label{H_36400DEA}
\matlabheadingthree{Modelo SIR}

\begin{par}
\begin{flushleft}
Usaremos el modelo \textbf{SIR} de acuerdo al siguiente sistema de ecuaciones:
\end{flushleft}
\end{par}

\begin{par}
$$\begin{array}{l}
\frac{\textrm{dS}}{\textrm{dt}}=-\beta \cdot \mathrm{S}\cdot \mathrm{I}+\delta \cdot \mathrm{R}\\
\frac{\textrm{dI}}{\textrm{dt}}=\beta \cdot \mathrm{S}\cdot \mathrm{I}-\gamma \cdot \mathrm{I}\\
\frac{\textrm{dR}}{\textrm{dt}}=\gamma \cdot \mathrm{I}-\delta \cdot \mathrm{R}
\end{array}$$
\end{par}

\begin{par}
\begin{flushleft}
Aquí $\beta \cdot \mathrm{S}\cdot \mathrm{I}$ representa la cantidad de personas que son contagiadas, es decir, los que pasan de ser susceptibles a ser contagiados (infectados). Es por esto que la constante $\beta$ (beta) representa la tasa de infección. Se sabe que unas cepas de covid son más infecciosas que otras.
\end{flushleft}
\end{par}

\begin{par}
\begin{flushleft}
De la misma forma $\delta$ representa la pérdida de inmunidad. Por eso $\delta \cdot \mathrm{R}$ representa a aquellos que pasan del compartimiento de \textit{\textbf{R}}\textit{emoved}, a ser susceptibles otra vez, es decir que pueden volverse a infectar.
\end{flushleft}
\end{par}

\begin{par}
\begin{flushleft}
Por último $\gamma$(gamma) representa la tasa de recuperación.
\end{flushleft}
\end{par}

\begin{par}
\begin{flushleft}
\includegraphics[width=\maxwidth{45.05770195684897em}]{image_0}
\end{flushleft}
\end{par}

\begin{par}
\begin{flushleft}
    \textbf{Figura 1: }Diagrama de flujo del modelo SIR
\end{flushleft}
\end{par}


\vspace{1em}
\label{H_B9862688}
\matlabheadingthree{Modelo SIRD}

\begin{par}
\begin{flushleft}
Podemos agregar más variantes al modelo base \textbf{SIR }para hacerlo más interesante y realista. En este caso agregamos un compartimento extra para los decesos. De esta forma, solo pasarán a \textbf{R} los recuperados y los muertos se pasarán al nuevo compartimento \textbf{D}
\end{flushleft}
\end{par}

\begin{par}
\begin{flushleft}
\includegraphics[width=\maxwidth{60.210737581535376em}]{image_1}
\end{flushleft}
\end{par}

\begin{par}
\begin{flushleft}
\textbf{    Figura 2: }Diagrama de flujo del modelo SIRD\textbf{ }
\end{flushleft}
\end{par}


\vspace{1em}
\begin{par}
\begin{flushleft}
Nuestro nuevo sistema de ecuaciones se ve de la siguiente manera.
\end{flushleft}
\end{par}

\begin{par}
$$\begin{array}{l}
\frac{\textrm{dS}}{\textrm{dt}}=-\beta \cdot \mathrm{S}\cdot \mathrm{I}+\delta \cdot \mathrm{R}\\
\frac{\textrm{dI}}{\textrm{dt}}=\beta \cdot \mathrm{S}\cdot \mathrm{I}-\gamma \cdot \mathrm{I}-\mu \cdot I\\
\frac{\textrm{dR}}{\textrm{dt}}=\gamma \cdot \mathrm{I}-\delta \cdot \mathrm{R}\\
\frac{\textrm{dD}}{\textrm{dt}}=\mu \cdot I
\end{array}$$
\end{par}

\label{H_F5511AD2}
\matlabheadingtwo{Creación del modelo con datos}

\begin{par}
\begin{flushleft}
Antes de implementar el modelo es importante mencionar las razones por las que el modelo no se verá como una curva real de covid con varios repuntes. Los coeficientes usados aquí son promedios obtenidos de los datos de \href{https://covid.ourworldindata.org/data/owid-covid-data.csv}{OWID} para el Reino Unido (UK). Esto causa que no se tome en cuenta las diferentes medidas tomadas por el gobierno para controlar en cierto espacio de tiempo, solo refleja cómo se comporta en promedio.
\end{flushleft}
\end{par}

\begin{par}
\begin{flushleft}
Para la tasa de pérdida de inmunidad no existen los datos para calcularlo en para un país en específico, así que usaremos un valor promedio usado en \href{https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7598795/}{otros estudios}.
\end{flushleft}
\end{par}


\vspace{1em}
\begin{matlabcode}
% Model parameters for the UK
beta = 9.6905E-09; % rate of infection
gamma = 0.532271959; % rate of recovery 
delta = 1/60; % rate of immunity loss 100 days
mu = 0.085470461; % fatallity rate
N = 66650000; % Total UK population 
I0 = 10; % initial number of infected
T =  500; % period of 300 days
dt = 1/4; % time interval of 6 hours (1/4 of a day)
fprintf('La tasa de reproducción R es de %.2f',N*beta/gamma)
\end{matlabcode}
\begin{matlaboutput}
La tasa de reproducción R es de 1.21
\end{matlaboutput}
\begin{matlabcode}
[t,S,I,R,D] = modelSIRD(beta,gamma,delta,mu,N,I0,T,dt);
\end{matlabcode}

\label{H_AE618BE1}
\matlabheading{Pruebas y resultados}

\begin{matlabcode}
semilogy(t,[S,I,R,D])
hold on
%plot(t,I); 
%plot(t,R); 
%plot(t,D); 


%grid on;
xlabel('Days'); 
ylabel('Number of individuals');
legend('S','I','R','D','Location','southeast');
hold off
\end{matlabcode}
\begin{center}
\includegraphics[width=\maxwidth{56.196688409433015em}]{figure_0.eps}
\end{center}
\begin{matlabcode}

[v,i]=max(I);
d=i/4;
fprintf('El pico de casos activos es de %d y sucede %d días después de que empezó la pandemia',round(v),round(d))
\end{matlabcode}
\begin{matlaboutput}
El pico de casos activos es de 101819 y sucede 386 días después de que empezó la pandemia
\end{matlaboutput}
\begin{matlabcode}
[v,i]=max(D);
d=i/4;
fprintf('El total de muertes son %d al día %d desde que empezó la pandemia',round(v),round(d))
\end{matlabcode}
\begin{matlaboutput}
El total de muertes son 1412387 al día 500 desde que empezó la pandemia
\end{matlaboutput}


\begin{par}
\begin{flushleft}
La gráfica que resulta del modelo SIRD puede no distanciarse mucho de la gráfica real por las limitaciones que mencionamos antes. Es importante ver que el modelo solo nos muestra el rol que juega cada variable dentro de una determinada población. En el caso del Reino Unido, la tasa de mortalidad varía desde 2\% hasta 14\% dependiendo de la fecha.
\end{flushleft}
\end{par}

\label{H_B1B6F5D8}
\matlabheadingtwo{Comparación datos reales}

\begin{par}
\begin{flushleft}
Comparemos la acumulación de muertes de nuestra predicción contra los datos de OWID.
\end{flushleft}
\end{par}

\begin{matlabcode}
data= readtable('UK-cum-death.csv');
data([end-499:end],[2,4,5])
\end{matlabcode}
\begin{matlabtableoutput}
{
\begin{tabular} {|c|c|c|c|}\hline
\mlcell{ } & \mlcell{areaName} & \mlcell{date} & \mlcell{cumDailyNsoDeathsByDeathDate} \\ \hline
\mlcell{1} & \mlcell{'United Kingdom'} & \mlcell{06/12/2021} & \mlcell{153753} \\ \hline
\mlcell{2} & \mlcell{'United Kingdom'} & \mlcell{06/11/2021} & \mlcell{153742} \\ \hline
\mlcell{3} & \mlcell{'United Kingdom'} & \mlcell{06/10/2021} & \mlcell{153729} \\ \hline
\mlcell{4} & \mlcell{'United Kingdom'} & \mlcell{06/09/2021} & \mlcell{153714} \\ \hline
\mlcell{5} & \mlcell{'United Kingdom'} & \mlcell{06/08/2021} & \mlcell{153698} \\ \hline
\mlcell{6} & \mlcell{'United Kingdom'} & \mlcell{06/07/2021} & \mlcell{153683} \\ \hline
\mlcell{7} & \mlcell{'United Kingdom'} & \mlcell{06/06/2021} & \mlcell{153677} \\ \hline
\mlcell{8} & \mlcell{'United Kingdom'} & \mlcell{06/05/2021} & \mlcell{153664} \\ \hline
\mlcell{9} & \mlcell{'United Kingdom'} & \mlcell{06/04/2021} & \mlcell{153658} \\ \hline
\mlcell{10} & \mlcell{'United Kingdom'} & \mlcell{06/03/2021} & \mlcell{153646} \\ \hline
\mlcell{11} & \mlcell{'United Kingdom'} & \mlcell{06/02/2021} & \mlcell{153631} \\ \hline
\mlcell{12} & \mlcell{'United Kingdom'} & \mlcell{06/01/2021} & \mlcell{153619} \\ \hline
\mlcell{13} & \mlcell{'United Kingdom'} & \mlcell{05/31/2021} & \mlcell{153609} \\ \hline
\mlcell{14} & \mlcell{'United Kingdom'} & \mlcell{05/30/2021} & \mlcell{153598} \\ \hline
\mlcell{15} & \mlcell{'United Kingdom'} & \mlcell{05/29/2021} & \mlcell{153590} \\ \hline
\mlcell{16} & \mlcell{'United Kingdom'} & \mlcell{05/28/2021} & \mlcell{153578} \\ \hline
\mlcell{17} & \mlcell{'United Kingdom'} & \mlcell{05/27/2021} & \mlcell{153565} \\ \hline
\mlcell{18} & \mlcell{'United Kingdom'} & \mlcell{05/26/2021} & \mlcell{153557} \\ \hline
\mlcell{19} & \mlcell{'United Kingdom'} & \mlcell{05/25/2021} & \mlcell{153543} \\ \hline
\mlcell{20} & \mlcell{'United Kingdom'} & \mlcell{05/24/2021} & \mlcell{153534} \\ \hline
\mlcell{21} & \mlcell{'United Kingdom'} & \mlcell{05/23/2021} & \mlcell{153518} \\ \hline
\mlcell{22} & \mlcell{'United Kingdom'} & \mlcell{05/22/2021} & \mlcell{153503} \\ \hline
\mlcell{23} & \mlcell{'United Kingdom'} & \mlcell{05/21/2021} & \mlcell{153499} \\ \hline
\mlcell{24} & \mlcell{'United Kingdom'} & \mlcell{05/20/2021} & \mlcell{153483} \\ \hline
\mlcell{25} & \mlcell{'United Kingdom'} & \mlcell{05/19/2021} & \mlcell{153477} \\ \hline
\mlcell{26} & \mlcell{'United Kingdom'} & \mlcell{05/18/2021} & \mlcell{153473} \\ \hline
\mlcell{27} & \mlcell{'United Kingdom'} & \mlcell{05/17/2021} & \mlcell{153464} \\ \hline
\mlcell{28} & \mlcell{'United Kingdom'} & \mlcell{05/16/2021} & \mlcell{153452} \\ \hline
\mlcell{29} & \mlcell{'United Kingdom'} & \mlcell{05/15/2021} & \mlcell{153439} \\ \hline
\mlcell{30} & \mlcell{'United Kingdom'} & \mlcell{05/14/2021} & \mlcell{153425} \\ \hline
\mlcell{31} & \mlcell{'United Kingdom'} & \mlcell{05/13/2021} & \mlcell{153411} \\ \hline
\mlcell{32} & \mlcell{'United Kingdom'} & \mlcell{05/12/2021} & \mlcell{153397} \\ \hline
\mlcell{33} & \mlcell{'United Kingdom'} & \mlcell{05/11/2021} & \mlcell{153382} \\ \hline
\mlcell{34} & \mlcell{'United Kingdom'} & \mlcell{05/10/2021} & \mlcell{153362} \\ \hline
\mlcell{35} & \mlcell{'United Kingdom'} & \mlcell{05/09/2021} & \mlcell{153354} \\ \hline
\mlcell{36} & \mlcell{'United Kingdom'} & \mlcell{05/08/2021} & \mlcell{153344} \\ \hline
\mlcell{37} & \mlcell{'United Kingdom'} & \mlcell{05/07/2021} & \mlcell{153324} \\ \hline
\mlcell{38} & \mlcell{'United Kingdom'} & \mlcell{05/06/2021} & \mlcell{153307} \\ \hline
\mlcell{39} & \mlcell{'United Kingdom'} & \mlcell{05/05/2021} & \mlcell{153290} \\ \hline
\mlcell{40} & \mlcell{'United Kingdom'} & \mlcell{05/04/2021} & \mlcell{153269} \\ \hline
\mlcell{41} & \mlcell{'United Kingdom'} & \mlcell{05/03/2021} & \mlcell{153254} \\ \hline
\mlcell{42} & \mlcell{'United Kingdom'} & \mlcell{05/02/2021} & \mlcell{153238} \\ \hline
\mlcell{43} & \mlcell{'United Kingdom'} & \mlcell{05/01/2021} & \mlcell{153220} \\ \hline
\mlcell{44} & \mlcell{'United Kingdom'} & \mlcell{04/30/2021} & \mlcell{153205} \\ \hline
\mlcell{45} & \mlcell{'United Kingdom'} & \mlcell{04/29/2021} & \mlcell{153189} \\ \hline
\mlcell{46} & \mlcell{'United Kingdom'} & \mlcell{04/28/2021} & \mlcell{153172} \\ \hline
\mlcell{47} & \mlcell{'United Kingdom'} & \mlcell{04/27/2021} & \mlcell{153151} \\ \hline
\mlcell{48} & \mlcell{'United Kingdom'} & \mlcell{04/26/2021} & \mlcell{153126} \\ \hline
\mlcell{49} & \mlcell{'United Kingdom'} & \mlcell{04/25/2021} & \mlcell{153107} \\ \hline
\mlcell{50} & \mlcell{'United Kingdom'} & \mlcell{04/24/2021} & \mlcell{153082} \\ \hline
\mlcell{51} & \mlcell{'United Kingdom'} & \mlcell{04/23/2021} & \mlcell{153058} \\ \hline
\mlcell{52} & \mlcell{'United Kingdom'} & \mlcell{04/22/2021} & \mlcell{153029} \\ \hline
\mlcell{53} & \mlcell{'United Kingdom'} & \mlcell{04/21/2021} & \mlcell{152996} \\ \hline
\mlcell{54} & \mlcell{'United Kingdom'} & \mlcell{04/20/2021} & \mlcell{152961} \\ \hline
\mlcell{55} & \mlcell{'United Kingdom'} & \mlcell{04/19/2021} & \mlcell{152928} \\ \hline
\mlcell{56} & \mlcell{'United Kingdom'} & \mlcell{04/18/2021} & \mlcell{152905} \\ \hline
\mlcell{57} & \mlcell{'United Kingdom'} & \mlcell{04/17/2021} & \mlcell{152875} \\ \hline
\mlcell{58} & \mlcell{'United Kingdom'} & \mlcell{04/16/2021} & \mlcell{152835} \\ \hline
\mlcell{59} & \mlcell{'United Kingdom'} & \mlcell{04/15/2021} & \mlcell{152805} \\ \hline
\mlcell{60} & \mlcell{'United Kingdom'} & \mlcell{04/14/2021} & \mlcell{152764} \\ \hline
\mlcell{61} & \mlcell{'United Kingdom'} & \mlcell{04/13/2021} & \mlcell{152731} \\ \hline
\mlcell{62} & \mlcell{'United Kingdom'} & \mlcell{04/12/2021} & \mlcell{152685} \\ \hline
\mlcell{63} & \mlcell{'United Kingdom'} & \mlcell{04/11/2021} & \mlcell{152649} \\ \hline
\mlcell{64} & \mlcell{'United Kingdom'} & \mlcell{04/10/2021} & \mlcell{152610} \\ \hline
\mlcell{65} & \mlcell{'United Kingdom'} & \mlcell{04/09/2021} & \mlcell{152567} \\ \hline
\mlcell{66} & \mlcell{'United Kingdom'} & \mlcell{04/08/2021} & \mlcell{152529} \\ \hline
\mlcell{67} & \mlcell{'United Kingdom'} & \mlcell{04/07/2021} & \mlcell{152469} \\ \hline
\mlcell{68} & \mlcell{'United Kingdom'} & \mlcell{04/06/2021} & \mlcell{152425} \\ \hline
\mlcell{69} & \mlcell{'United Kingdom'} & \mlcell{04/05/2021} & \mlcell{152380} \\ \hline
\mlcell{70} & \mlcell{'United Kingdom'} & \mlcell{04/04/2021} & \mlcell{152338} \\ \hline
\mlcell{71} & \mlcell{'United Kingdom'} & \mlcell{04/03/2021} & \mlcell{152288} \\ \hline
\mlcell{72} & \mlcell{'United Kingdom'} & \mlcell{04/02/2021} & \mlcell{152248} \\ \hline
\mlcell{73} & \mlcell{'United Kingdom'} & \mlcell{04/01/2021} & \mlcell{152198} \\ \hline
\mlcell{74} & \mlcell{'United Kingdom'} & \mlcell{03/31/2021} & \mlcell{152137} \\ \hline
\mlcell{75} & \mlcell{'United Kingdom'} & \mlcell{03/30/2021} & \mlcell{152063} \\ \hline
\mlcell{76} & \mlcell{'United Kingdom'} & \mlcell{03/29/2021} & \mlcell{152009} \\ \hline
\mlcell{77} & \mlcell{'United Kingdom'} & \mlcell{03/28/2021} & \mlcell{151941} \\ \hline
\mlcell{78} & \mlcell{'United Kingdom'} & \mlcell{03/27/2021} & \mlcell{151894} \\ \hline
\mlcell{79} & \mlcell{'United Kingdom'} & \mlcell{03/26/2021} & \mlcell{151832} \\ \hline
\mlcell{80} & \mlcell{'United Kingdom'} & \mlcell{03/25/2021} & \mlcell{151760} \\ \hline
\mlcell{81} & \mlcell{'United Kingdom'} & \mlcell{03/24/2021} & \mlcell{151685} \\ \hline
\mlcell{82} & \mlcell{'United Kingdom'} & \mlcell{03/23/2021} & \mlcell{151616} \\ \hline
\mlcell{83} & \mlcell{'United Kingdom'} & \mlcell{03/22/2021} & \mlcell{151524} \\ \hline
\mlcell{84} & \mlcell{'United Kingdom'} & \mlcell{03/21/2021} & \mlcell{151422} \\ \hline
\mlcell{85} & \mlcell{'United Kingdom'} & \mlcell{03/20/2021} & \mlcell{151299} \\ \hline
\mlcell{86} & \mlcell{'United Kingdom'} & \mlcell{03/19/2021} & \mlcell{151200} \\ \hline
\mlcell{87} & \mlcell{'United Kingdom'} & \mlcell{03/18/2021} & \mlcell{151099} \\ \hline
\mlcell{88} & \mlcell{'United Kingdom'} & \mlcell{03/17/2021} & \mlcell{151000} \\ \hline
\mlcell{89} & \mlcell{'United Kingdom'} & \mlcell{03/16/2021} & \mlcell{150875} \\ \hline
\mlcell{90} & \mlcell{'United Kingdom'} & \mlcell{03/15/2021} & \mlcell{150763} \\ \hline
\mlcell{91} & \mlcell{'United Kingdom'} & \mlcell{03/14/2021} & \mlcell{150629} \\ \hline
\mlcell{92} & \mlcell{'United Kingdom'} & \mlcell{03/13/2021} & \mlcell{150497} \\ \hline
\mlcell{93} & \mlcell{'United Kingdom'} & \mlcell{03/12/2021} & \mlcell{150363} \\ \hline
\mlcell{94} & \mlcell{'United Kingdom'} & \mlcell{03/11/2021} & \mlcell{150229} \\ \hline
\mlcell{95} & \mlcell{'United Kingdom'} & \mlcell{03/10/2021} & \mlcell{150061} \\ \hline
\mlcell{96} & \mlcell{'United Kingdom'} & \mlcell{03/09/2021} & \mlcell{149902} \\ \hline
\mlcell{97} & \mlcell{'United Kingdom'} & \mlcell{03/08/2021} & \mlcell{149717} \\ \hline
\mlcell{98} & \mlcell{'United Kingdom'} & \mlcell{03/07/2021} & \mlcell{149524} \\ \hline
\mlcell{99} & \mlcell{'United Kingdom'} & \mlcell{03/06/2021} & \mlcell{149330} \\ \hline
\mlcell{100} & \mlcell{'United Kingdom'} & \mlcell{03/05/2021} & \mlcell{149123} \\ 
\hline
\end{tabular}
}
\end{matlabtableoutput}
\begin{matlabcode}
column1 = table2cell(data(end-499:end,5)); %500 dias
deaths = cell2mat(column1);
days = 500:-1:1;
semilogy(days,deaths,"r o")
hold on
semilogy(t,D,"k")
xline(346,"--");
title("prediction model vs real data",' ')
ylabel("number of people")
xlabel("days elapsed")
legend("predicted","real","346 days of provided data","Location","best")
hold off
\end{matlabcode}
\begin{center}
\includegraphics[width=\maxwidth{56.196688409433015em}]{figure_1.eps}
\end{center}

\begin{par}
\begin{flushleft}
Como podía esperarse, al tomar una muestra tan grande de datos como lo son 346 días y simplemente promediar las tasas de cambio incurrimos en un error bastante grande.
\end{flushleft}
\end{par}

\begin{par}
\begin{flushleft}
Este modelo \textbf{no} cumple todos los requisitos formulados previamente ya que:
\end{flushleft}
\end{par}

\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item{\begin{flushleft} el modelo tiene demasiado error y no se asemeja a la curva de los datos reales \end{flushleft}}
\end{itemize}


\label{H_6E6EACF8}
\matlabheadingtwo{CASO ITALIA SIRD SIMPLE}

\begin{par}
\begin{flushleft}
El siguiente script usa datos del 1 de agosto de 2021 a 1 de noviembre de 2021 de Italia, recolectados igualmente del OWID.
\end{flushleft}
\end{par}

\begin{matlabcode}
% ITALY
% Model parameters for the UK
beta = 1.65869E-09; % rate of infection
%no mask
%beta = beta*1.1;

gamma = 0.076163777; % rate of recovery 
delta = 1/60; % rate of immunity loss 100 days
mu = 0.001166467; % fatallity rate
N = 66650000 % Total UK population N = S + I + R
\end{matlabcode}
\begin{matlaboutput}
N = 66650000
\end{matlaboutput}
\begin{matlabcode}
I0 = 6714; % initial number of infected = [diferencia de casos en 30 dias - (diferencia decesos en 30 dias)]
T =  180; % period of 300 days
dt = 1/12; % time interval of 6 hours (1/4 of a day)
D0=35146;
%R0=281707
R0=160686
\end{matlabcode}
\begin{matlaboutput}
R0 = 160686
\end{matlaboutput}
\begin{matlabcode}
fprintf('La tasa de reproducción R es de %.2f',N*beta/gamma)
\end{matlabcode}
\begin{matlaboutput}
La tasa de reproducción R es de 1.45
\end{matlaboutput}
\begin{matlabcode}

[t,S,I,R,D] = modelSIRD2(beta,gamma,delta,mu,N,I0,T,dt,R0,D0);
semilogy(t,[S,I,R,D])
legend('S','I','R','D','Location','best');
title("180 days italy prediction")
\end{matlabcode}
\begin{center}
\includegraphics[width=\maxwidth{56.196688409433015em}]{figure_2.eps}
\end{center}
\begin{matlabcode}
[v,i]=max(D);
d=i/12;
fprintf('El total de muertes son %d al día %d desde que empezó la pandemia \n',round(v),round(d))
\end{matlabcode}
\begin{matlaboutput}
El total de muertes son 116827 al día 180 desde que empezó la pandemia 
\end{matlaboutput}
\begin{matlabcode}
data = csvread('ITA-CUM-death.csv');
column1 = data(:,1);
days = 1:length(column1);
plot(t,D, "k","LineWidth",2)
hold on
plot(days,column1,"r o")
xline(90,"k--","data provided till day 90")
grid on
hold off
legend("predicted","real")
xlabel('Days since august 1st 2020'); 
ylabel("Death toll")
\end{matlabcode}
\begin{center}
\includegraphics[width=\maxwidth{56.196688409433015em}]{figure_3.eps}
\end{center}

\begin{par}
\begin{flushleft}
Podemos ver cómo el modelo simula mejor el comportamiento de las muertes acumuladas reales, sin embargo, las autoridades en Italia tomaron \href{https://www.garda.com/crisis24/news-alerts/367781/italy-authorities-extend-covid-19-restrictions-until-september-7-update-38}{medidas preventivas para reducir los contagios y las muertes}. 
\end{flushleft}
\end{par}

\begin{par}
\begin{flushleft}
Este modelo \textbf{sí }cumple todos los requisitos formulados previamente ya que:
\end{flushleft}
\end{par}

\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item{\begin{flushleft} es un modelo matemático de ODEs \end{flushleft}}
   \item{\begin{flushleft} su comportamiento es parecido a los datos reales \end{flushleft}}
   \item{\begin{flushleft} los datos usados para calcular los coeficientes sólo son de 90 días \end{flushleft}}
\end{itemize}


\vspace{1em}

\label{H_A4AED358}
\matlabheadingtwo{CASO ITALIA SIRD AVANZADO [2]}

\begin{par}
\begin{flushleft}
Implementaremos el modelo del siguiente diagrama [2]
\end{flushleft}
\end{par}

\begin{par}
\begin{flushleft}
\includegraphics[width=\maxwidth{50.17561465127948em}]{image_2}
\end{flushleft}
\end{par}

\begin{par}
\begin{flushleft}
    \textbf{Figura 3: }Diagrama SIRD avanzado
\end{flushleft}
\end{par}

\begin{par}
\begin{flushleft}
Este modelo debería tomar una forma más realista ya que toma en cuenta más variables, como puede apreciarse  en la figura 3, tenemos los siguientes compartimentos.
\end{flushleft}
\end{par}

\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item{\begin{flushleft} Susceptibles \end{flushleft}}
   \item{\begin{flushleft} Expuestos \end{flushleft}}
   \item{\begin{flushleft} Asintomáticos \end{flushleft}}
   \item{\begin{flushleft} Infectados \end{flushleft}}
   \item{\begin{flushleft} confinado (guarda distancia en casa) \end{flushleft}}
   \item{\begin{flushleft} En cuarentena (infectado pero ya no infecta más gente) \end{flushleft}}
   \item{\begin{flushleft} Recuperados \end{flushleft}}
   \item{\begin{flushleft} Muertes \end{flushleft}}
\end{itemize}


\vspace{1em}
\begin{matlabcode}
%italy
N = 6.046*10^7;
alpha = 0.0194;
beta=7.567;
mu=2.278 * 10^-6;
nao=9.180  * 10^-7;
sigma=1.463^-3;
tao=1.109  * 10^-4;
epsilon=0.263;
gamma=0.021;
delta=	0.077;
lambda0 = 	0.157;
lambda1 = 0.025;
k0 = 0.779;
k1 = 0.061;
x0=0;
T = 180;
dt = 1/4; 
y0= [N; 1; 0; 1; 1; 0; 1; 0];
[t,S, A, C, E, I, R, Q, D] = modelSIRDAvanzado(alpha,beta,mu,nao,sigma,tao,epsilon,gamma,delta,lambda0,lambda1,k0,k1,N,y0,x0,dt,T);
plot(t,S,'-',t, A,'--',t, C,':',t, E,'-.',t, I,'-',t, R,'--',t, Q,':',t, D,'-')
%ylim([0 3*10^7])
ylabel("Población")
xlabel("dias")
title("Italia SIRD-avanzado desde el inicio de la epidemia")
legend('S', 'A', 'C', 'E', 'I', 'R', 'Q', 'D')
\end{matlabcode}
\begin{center}
\includegraphics[width=\maxwidth{56.196688409433015em}]{figure_4.eps}
\end{center}
\begin{matlabcode}
plot(t,S,'-',t, A,'--',t, C,':',t, E,'-.',t, I,'-',t, R,'--',t, Q,':',t, D,'y-')
ylim([0 1.5*10^7])
ylabel("Población")
xlabel("dias")
title("Italia SIRD-avanzado desde el inicio de la epidemia (zoom)",' ')
legend('S', 'A', 'C', 'E', 'I', 'R', 'Q', 'D')
\end{matlabcode}
\begin{center}
\includegraphics[width=\maxwidth{56.196688409433015em}]{figure_5.eps}
\end{center}
\begin{matlabcode}
%data = csvread('ITA-CUM-death-day0-180.csv');
T = readtable('ITA-CUM-death-day0-180.csv');
column1 = T{:,1};

%column1 = data(:,1);
days = 1:length(column1);
semilogy(t,D, "k","LineWidth",2)
hold on
semilogy(days,column1,"r o")
%grid on
hold off
title("Muertes en Italia desde el inicio de la pandemia")
legend("predicted","real",'Location','southeast')
xlabel('Days'); 
ylabel("Death toll");
\end{matlabcode}
\begin{center}
\includegraphics[width=\maxwidth{56.196688409433015em}]{figure_6.eps}
\end{center}

\begin{par}
\begin{flushleft}
Aunque los números de la predicción son mayores, el comportamiento es parecido, pues ambas gráficas se empiezan a aplanar a los 40-60 días.
\end{flushleft}
\end{par}

\begin{par}
\begin{flushleft}
Este modelo con estos datos en particular \textbf{no }cumple con los requisitos definidos ya que los números no son realistas. 
\end{flushleft}
\end{par}


\label{H_138E73D0}
\matlabheadingtwo{Entendiendo la importancia de los coeficientes}

\begin{par}
\begin{flushleft}
Revisemos el caso del Reino Unido  otra vez con el modelo SIRD simple para observar incrementos en las variables de tasa de infección (beta) y tasa de recuperación (gamma).
\end{flushleft}
\end{par}

\begin{matlabcode}
% Model parameters for the UK
beta = 9.6905E-09; % rate of infection
gamma = 0.532271959; % rate of recovery 
delta = 1/60; % rate of immunity loss 100 days
mu = 0.085470461; % fatallity rate
N = 66650000; % Total UK population 
I0 = 10; % initial number of infected
T =  500; % period of 300 days
dt = 1/4; % time interval of 6 hours (1/4 of a day)
[t,S,I,R,D] = modelSIRD(beta,gamma,delta,mu,N,I0,T,dt);
\end{matlabcode}

\label{H_28273C0D}
\matlabheadingthree{BETA}

\begin{par}
\begin{flushleft}
Los datos tomados para este estudio son los promedios de esas variables desde que empezó el 1 de febrero de 2020 hasta el pico de casos el 9 de enero de 2021. Para estas últimas fechas el proceso de vacunación (que empezó en diciembre 13 de 2020) juega un papel importante en reducir el número de decesos y contagios.
\end{flushleft}
\end{par}

\begin{par}
\begin{flushleft}
Veamos ahora qué pasa si se relajan las medidas preventivas, es decir, un aumento en el coeficiente de infección \textbf{beta}
\end{flushleft}
\end{par}

\begin{matlabcode}

betaBase = beta
\end{matlabcode}
\begin{matlaboutput}
betaBase = 9.6905e-09
\end{matlaboutput}
\begin{matlabcode}
for i = 1.1:0.1:1.5
    figure;
    beta = betaBase * i;
    
    [t,S,I,R,D] = modelSIRD(beta,gamma,delta,mu,N,I0,T,dt);
    semilogy(t,[S,I,R,D])    
    
    hold on
    title("SIRD con beta al "+i*100+" %")
    xlabel('Days'); 
    ylabel('Number of individuals');
    legend('S','I','R','D','Location','southeast');
    hold off
    [v,i]=max(D);
    d=i/4;
    fprintf('el valor de beta es %d',beta)
    fprintf('La tasa de reproducción R es de %.2f',N*beta/gamma)
    fprintf('El total de muertes son %d al día %d desde que empezó la pandemia \n',round(v),round(d))
end
\end{matlabcode}
\begin{center}
\includegraphics[width=\maxwidth{56.196688409433015em}]{figure_7.eps}
\end{center}
\begin{matlaboutput}
el valor de beta es 1.065955e-08
La tasa de reproducción R es de 1.33
El total de muertes son 5716279 al día 500 desde que empezó la pandemia 
\end{matlaboutput}
\begin{center}
\includegraphics[width=\maxwidth{56.196688409433015em}]{figure_8.eps}
\end{center}
\begin{matlaboutput}
el valor de beta es 1.162860e-08
La tasa de reproducción R es de 1.46
El total de muertes son 9269041 al día 500 desde que empezó la pandemia 
\end{matlaboutput}
\begin{center}
\includegraphics[width=\maxwidth{56.196688409433015em}]{figure_9.eps}
\end{center}
\begin{matlaboutput}
el valor de beta es 1.259765e-08
La tasa de reproducción R es de 1.58
El total de muertes son 12173548 al día 500 desde que empezó la pandemia 
\end{matlaboutput}
\begin{center}
\includegraphics[width=\maxwidth{56.196688409433015em}]{figure_10.eps}
\end{center}
\begin{matlaboutput}
el valor de beta es 1.356670e-08
La tasa de reproducción R es de 1.70
El total de muertes son 14777172 al día 500 desde que empezó la pandemia 
\end{matlaboutput}
\begin{center}
\includegraphics[width=\maxwidth{56.196688409433015em}]{figure_11.eps}
\end{center}
\begin{matlaboutput}
el valor de beta es 1.453575e-08
La tasa de reproducción R es de 1.82
El total de muertes son 16935175 al día 500 desde que empezó la pandemia 
\end{matlaboutput}

\begin{par}
\begin{flushleft}
Podemos ver cómo un incremento de apenas el 10\% resulta en un gran incremento de decesos. En un escenario real, incrementa a la vez la tasa de mortalidad y decrementar por lo tanto la tasa de recuperación. Esto debido al sobrecupo de los hospitales.
\end{flushleft}
\end{par}

\label{H_256FF87E}
\matlabheadingthree{GAMMA}

\begin{par}
\hfill \break
\end{par}

\begin{matlabcode}
beta = betaBase;
gammaBase = gamma;
for gamma = gammaBase:-0.11:gammaBase-0.11*4
    figure;
    
    [t,S,I,R,D] = modelSIRD(beta,gamma,delta,mu,N,I0,T,dt);
    semilogy(t,[S,I,R,D])    
    
    hold on
    title("SIRD con gamma = "+gamma)
    xlabel('Days'); 
    ylabel('Number of individuals');
    legend('S','I','R','D','Location','best');
    hold off
    [v,i]=max(D);
    d=i/4;
    fprintf('el valor de gamma es %d',gamma)
    fprintf('La tasa de reproducción R es de %.2f',N*beta/gamma)
    fprintf('El total de muertes son %d al día %d desde que empezó la pandemia \n',round(v),round(d))
end
\end{matlabcode}
\begin{center}
\includegraphics[width=\maxwidth{56.196688409433015em}]{figure_12.eps}
\end{center}
\begin{matlaboutput}
el valor de gamma es 5.322720e-01
La tasa de reproducción R es de 1.21
El total de muertes son 1412387 al día 500 desde que empezó la pandemia 
\end{matlaboutput}
\begin{center}
\includegraphics[width=\maxwidth{56.196688409433015em}]{figure_13.eps}
\end{center}
\begin{matlaboutput}
el valor de gamma es 4.222720e-01
La tasa de reproducción R es de 1.53
El total de muertes son 10638058 al día 500 desde que empezó la pandemia 
\end{matlaboutput}
\begin{center}
\includegraphics[width=\maxwidth{56.196688409433015em}]{figure_14.eps}
\end{center}
\begin{matlaboutput}
el valor de gamma es 3.122720e-01
La tasa de reproducción R es de 2.07
El total de muertes son 21657465 al día 500 desde que empezó la pandemia 
\end{matlaboutput}
\begin{center}
\includegraphics[width=\maxwidth{56.196688409433015em}]{figure_15.eps}
\end{center}
\begin{matlaboutput}
el valor de gamma es 2.022720e-01
La tasa de reproducción R es de 3.19
El total de muertes son 34454982 al día 500 desde que empezó la pandemia 
\end{matlaboutput}
\begin{center}
\includegraphics[width=\maxwidth{56.196688409433015em}]{figure_16.eps}
\end{center}
\begin{matlaboutput}
el valor de gamma es 9.227196e-02
La tasa de reproducción R es de 7.00
El total de muertes son 48173566 al día 500 desde que empezó la pandemia 
\end{matlaboutput}


\label{H_CDD99D92}
\matlabheading{Conclusión}

\begin{par}
\begin{flushleft}
Entender este comportamiento de la pandemia causada por la enfermedad coronavirus nos permite ver las medidas sanitarias necesarias, estructurar medidas de mitigación y contención, hacer estimaciones de la capacidad hospitalaria, entre otros. Esto se debe a que en los modelos matemáticos usados podemos interactuar con las variables y así tratar de predecir el comportamiento de varios aspectos de la pandemia. En este caso es más fácil describir las variables por cómo cambian en lugar de por lo que representan. Es por esto que estos sistemas físicos son sistemas de ecuaciones diferenciales.
\end{flushleft}
\end{par}

\begin{par}
\begin{flushleft}
Como vimos en el caso de Inglaterra, al usar un promedio de un año para los datos, el modelo se distancia mucho de la realidad. A pesar de necesitar menos datos que los modelos estadísticos, los modelos de ecuaciones diferenciales ordinarias (como es el SIRD) dependen grandemente de los coeficientes.
\end{flushleft}
\end{par}

\begin{par}
\begin{flushleft}
En el primer caso de Italia con SIRD simple obtuvimos buenos resultados. Esto se debe a que los coeficientes tienen sentido para este marco de tiempo. Podríamos probablemente recortar los datos a tan solo 14 días y obtener una buena simulación de los siguientes 30 días si la situación no cambia. Es aquí donde vemos cómo estos modelos nos muestran un escenario realista o muy aproximado a la realidad. De esta forma, podemos reaccionar proactivamente antes de una catástrofe.
\end{flushleft}
\end{par}

\begin{par}
\begin{flushleft}
El último modelo está hecho para verse de una forma retrospectiva, difícilmente podremos calcular todos los coeficientes de forma previa. Pero podemos calcular diferentes escenarios jugando con estos coeficientes y ver la severidad de estos casos hipotéticos.
\end{flushleft}
\end{par}

\begin{par}
\begin{flushleft}
Finalmente, observamos cómo solamente el SIRD simple de Italia cumple con todos los requisitos. Al contrario del SIRD avanzado. Esto también nos muestra cómo los sistemas más complejos son muy delicados en cuanto a la exactitud de los parámetros (coeficientes) que se usan en el modelo. El modelo y su efectividad dependen más fuertemente de estos coeficientes que de su complejidad misma. 
\end{flushleft}
\end{par}


\label{H_C5AFABC0}
\matlabheading{Referencias}

\begin{par}
\begin{flushleft}
[1] R. Beckley, C.Weatherspoon, M. Alexander , M. Chandler, A.Johnson , and G. S. Bhatt."Modeling epidemics with differential equations". Tennessee State University. \href{https://www.tnstate.edu/mathematics/mathreu/filesreu/GroupProjectSIR.pdf}{[link]}. visitado 5/7/2021
\end{flushleft}
\end{par}

\begin{par}
\begin{flushleft}
[2] \href{https://pubs.acs.org/doi/10.1021/acs.iecr.0c04754}{Ind. Eng. Chem. Res. 2021, 60, 11, 4251–4260}
\end{flushleft}
\end{par}


\label{H_95915F88}
\matlabheading{Implementación}

\begin{matlabcode}
function [t,S,I,R] = modelSIR(beta,gamma,delta,N,I0,T,dt)
    [t,y] = runKut4(@(t,y) SIRfunc(t,y,beta,gamma,delta),0,dt,T,[N-I0;I0;0]);    
    S=y(:,1);
    I=y(:,2);
    R=y(:,3);
end

function [t,S,I,R,D] = modelSIRD(beta,gamma,delta,mu,N,I0,T,dt)
    [t,y] = runKut4(@(t,y) SIRDfunc(t,y,beta,gamma,delta,mu,N),0,dt,T,[N-I0;I0;0;0]);  
    S=y(:,1);
    I=y(:,2);
    R=y(:,3);
    D=y(:,4);
end

function [t,S,I,R,D] = modelSIRD2(beta,gamma,delta,mu,N,I0,T,dt,R0,D0)
    [t,y] = runKut4(@(t,y) SIRDfunc(t,y,beta,gamma,delta,mu,N),0,dt,T,[N-I0;I0;R0;D0]);  
    S=y(:,1);
    I=y(:,2);
    R=y(:,3);
    D=y(:,4);
end

function [t,S, A, C, E, I, R, Q, D] = modelSIRDAvanzado(alpha,beta,mu,nao,sigma,tao, ...
    epsilon,gamma,delta,lambda0,lambda1,k0,k1,N,y0,x0,dt,T)
    
    [t,y] = ode45(@(t,y) SIRDAfunct(t,y,alpha,beta,mu,nao,sigma,tao,epsilon ...
        ,gamma,delta,lambda0,lambda1,k0,k1,T,N),x0:dt:T,y0);
    
    S=y(:,1);
    A=y(:,2);
    C=y(:,3);
    E=y(:,4);
    I=y(:,5);
    R=y(:,6);
    Q=y(:,7);
    D=y(:,8);
    
end

function [xSol,ySol] = runKut4(F,x0,h,xStop,y0)
    
    reshape( y0, [],1 ); % column vector
    xSol = zeros(2,1); 
    ySol = zeros(length(y0),2);
    xSol(1) = x0; 
    ySol(:,1) = y0;
    i = 1;
    x=x0;
    y=y0;    
    while x < xStop
        i = i + 1;
        h = min(h,xStop - x);
        K1 = h*F(x,y);
        K2 = h*F(x + h/2,y + K1/2);
        K3 = h*F(x + h/2,y + K2/2);
        K4 = h*F(x+h,y + K3);
        y = y + (K1 + 2*K2 + 2*K3 + K4)/6;
        x = x + h;
        xSol(i) = x;
        ySol(:,i) = y; 
    end
    
    xSol = xSol';
    ySol=ySol';
end

function dydt = SIRfunc(t,y,beta,gamma,delta)
    dydt = zeros(3,1);
    %dydt(1)=dS
    %dydt(2)=dI
    %dydt(3)=dR
    dydt(1) = (-beta.*y(2).*y(1) + delta.*y(3));    
    dydt(2) = (beta.*y(2).*y(1) - gamma.*y(2));
    dydt(3) = (gamma.*y(2) - delta.*y(3));
end

function dydt = SIRDfunc(t,y,beta,gamma,delta,mu,N)
    dydt = zeros(4,1);
    %dydt(1)=dS
    %dydt(2)=dI
    %dydt(3)=dR
    dydt(1) = (-beta.*y(2).*y(1) + delta.*y(3));
    dydt(2) = (beta.*y(2).*y(1) - gamma.*y(2) -mu.*y(2));
    dydt(3) = (gamma.*y(2) - delta.*y(3));
    dydt(4) = mu.*y(2);
end

function dydt = SIRDAfunct(t,y,alpha,beta,mu,nao,sigma,tao,epsilon,gamma,delta,lambda0,lambda1,k0,k1,tf,N)
    dydt = zeros(8,1);
    %S=1, A=2, C=3, E=4, I=5, R=6, Q=7, D=8
    
    dydt(1) = -alpha*y(1) - beta*y(5)*y(6)./N - sigma*y(1)*y(2)./N -nao*y(1); %dS
    dydt(2) = - tao*y(2) + epsilon*y(4); %dA
    dydt(3) = (alpha*y(1)./N) -mu*y(3); %dC
    dydt(4) = -gamma*y(4) +beta*y(5)*y(1)./N +mu*y(3)+nao*y(1) +sigma*y(1)*y(2)./N -epsilon*y(4); %dE
    dydt(5) = tao*y(2)+gamma*y(4)-delta*y(5); %dI
    dydt(6) = (lambda0 + (t/tf)*(lambda1-lambda0))*y(7); %dR
    dydt(7) = delta*y(5)-((lambda0 + (t/tf)*(lambda1-lambda0))*y(7)) -((k0 + (t/tf)*(k1-k0))*y(7)); %dQ
    dydt(8) = (k0 + (t/tf)*(k1-k0))*y(7); %dD

end



\end{matlabcode}

\end{document}
